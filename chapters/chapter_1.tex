
\chapter{绪论}

\section{研究背景}
    二十世纪中叶，随着工业技术、控制理论、计算机技术的快速发展，机器人技术开始萌芽\upcite{nilsson1969a}。在二十世纪末，机器人不仅更多地被应用于工业领域，也进入了人们的生活，改善了人们的生活水平，与机器人有关的技术因此得到了大范围的应用。机器人提高了社会生产力，能够代替人类完成危险的工作，大大降低了人类遭遇危机的概率。在机器人中具有移动能力的类型被称为移动机器人，它们不同于固定位置工作的机械臂，在一定程度上对人类的移动能力进行模拟和扩展。\par
    移动机器人在机器人中所占比重巨大，它凭借在空间中移动的能力，有效地扩大了机器人的工作范围和空间。常见的移动机器人有无人机、自动驾驶汽车、搬运机器人、扫地机器人等，其中无人机和自动驾驶汽车因为它们广泛的应用领域与不菲的商业价值而逐渐被商用化，搬运机器人则更多地被运用于工业场景中，协助货物的运输，扫地机器人作为消费级的机器人，在家庭中普及，在服务业大展身手。根据工作环境的不同，移动机器人可分为室外移动机器人和室内移动机器人。\par
    \begin{figure}[htb]
        \centering
        \subfigure[无人机]{
            \begin{minipage}{0.31\textwidth}
                \centering
                \includegraphics[width=1.0\textwidth]{1-1a.jpg}
                \label{img1_1a}
            \end{minipage}
        }
        \subfigure[自动驾驶汽车]{
            \begin{minipage}{0.31\textwidth}
                \centering
                \includegraphics[width=1.0\textwidth]{1-1b.jpg}
                \label{img1_1b}
            \end{minipage}
        }
        \subfigure[无人地面车]{
            \begin{minipage}{0.31\textwidth}
                \centering
                \includegraphics[width=1.0\textwidth]{1-1c.jpg}
                \label{img1_1c}
            \end{minipage}
        }
        \caption{室外移动机器人}
        \label{img1_1}
    \end{figure}
    无人机、自动驾驶汽车、无人地面车多工作在室外场景下，属于室外移动机器人。图\ref{img1_1a}中的大疆无人机~Inspire 2~是典型的室外移动机器人，它配备有前视和下视的双目视觉系统，能够对~30~米范围内的障碍物进行检测，同时在顶部配置红外感知系统，能有效感知上方~5~米范围内的物体。图\ref{img1_1b}中的特斯拉自动驾驶汽车~Tesla Model X~环绕车身配置~8~个相机，视野范围达~360~度，对周围环境的监测距离最远可达~250~米，传感器的配置弥补了视觉系统的不足，在保证监测范围的基础上增加了对软硬物体的探测。图\ref{img1_1c}为~CLEARPATH~研发的无人地面车~JACKAL~，车外壳完全防水，高扭矩传动系统保证了足够的牵引力，能够在复杂的室外地形中无障碍地移动。\par
    \begin{figure}[htb]
        \centering
        \subfigure[仿生服务机器人]{
            \begin{minipage}{0.31\textwidth}
                \centering
                \includegraphics[width=1.0\textwidth]{1-2a.jpg}
                \label{img1_2a}
            \end{minipage}
        }
        \subfigure[仓储机器人]{
            \begin{minipage}{0.31\textwidth}
                \centering
                \includegraphics[width=1.0\textwidth]{1-2b.jpg}
                \label{img1_2b}
            \end{minipage}
        }
        \subfigure[扫地机器人]{
            \begin{minipage}{0.31\textwidth}
                \centering
                \includegraphics[width=1.0\textwidth]{1-2c.jpg}
                \label{img1_2c}
            \end{minipage}
        }
        \caption{室内移动机器人}
        \label{img1_2}
    \end{figure}
    仿生服务机器人、仓储机器人、扫地机器人的工作场景多为室内，是典型的室内移动机器人。法国~Aldebaran Robotics~公司开发的人形寓教机器人~NAO~，如图\ref{img1_2a}，具有类人的四肢，能够进行多种形式的表现，完成对儿童、老人的陪护，同时其高可动性被用于避障、抓取等研究。图\ref{img1_2b}为亚马逊的~kiva~仓储机器人，它只有~145~公斤的重量，却能搬起远超自身重量的货物，且具备稳定的导航系统，对商品的扫描准确率高达~99.99\%~。图\ref{img1_2c}中的米家扫地机器人是一种自主移动机器人，配置有多个传感器，能够在室内进行地图的实时绘制，从而规划路线完成智能化的清扫，如今已普遍应用于家庭中。\par
    移动机器人完成相应任务的大前提是知晓自身的位置，即定位。对比室外移动机器人和室内移动机器人，前者的工作场景不是特别复杂，且如今已存在比较成熟的~GPS~定位技术表达机器人与环境的位置关系，机器人容易理解环境，而后者的工作环境更加繁杂，且无法运用~GPS~进行定位，但是室内环境的视觉信息比较丰富，环境特征更有标志性，通过计算机视觉对室内移动机器人进行精准定位具有更好的研究前景。

\section{国内外研究现状}
    室外场景下的定位技术依赖于固定传感器或是基于~GPS~的传感器\upcite{agrawal2006real-time,bulusu2000gps-less}，而且~GPS~因其能提供最大的覆盖面积而成为使用最广泛的基于卫星的定位系统\upcite{hightower2001location}。但是以下问题的存在使得室外定位技术应用于室内场景存在较大的局限性：（1）室内环境相对室外环境变得更加复杂；（2）室内存在较强的信号干扰和反射，依靠信号进行的定位误差将会很大；（3）室内定位对室内环境的依赖性极强；（4）室内通信链路变得不可靠\upcite{beresford2003location}。\par
    为解决上述问题，诸多室内定位技术被提出，如~WIFI~定位、超声波定位、射频识别\upcite{weinstein2005rfid:}定位、超宽带（Ultra Wide Band，UWB）定位、计算机视觉定位等，研究人员利用这些定位技术构建定位系统以达到定位的精度需求。\par
    如今~WIFI~在室内应用广泛，且覆盖面大，~WIFI~定位成为目前室内定位领域的研究热点。借助接入点（Access Point，AP），~Kotaru~等人在2015年提出~Spotfi~系统\upcite{kotaru2015spotfi:}，达到了~40~厘米的较高精度，但是该系统因为~WIFI~信号的数量限制无法被用于实时场景。~2016~年，~Wooseong Kim~和~Sungwon Yang~提出基于~WIFI~定位的系统~Freeloc~\upcite{kim2016crowdsource}，它通过收集~WIFI~位置信息自动进行地图构建，从而达到实时定位的目的，然而该系统的定位精度却远不如~Spotfi~。\par
    在超声波定位领域，定位技术更加成熟，在定位精度方面表现优异。早在~1997~年，~Andrew Ward~等人提出了~BAT~系统\upcite{ward1997a}，利用超声波信号进行室内定位，~Harle Robert~与~Hopper Andy~对该系统进行了全面的实验评估工作\upcite{harle2005deploying}，精度高达~4~厘米，然而定位精度过分依赖于传感器的摆放位置且系统的额外设备开销较大，使得该系统虽然具有先进性却没有应用于大部分的场景。在射频识别定位领域，~Lionel M Ni~等人在~2003~年提出~LANDMARC~系统\upcite{ni2003landmarc:}，是具有开拓性的一套定位系统，它要求被定位对象表面依附射频识别标记，通过标记检测器获取标记信号强度的信息并结合~k~最近邻算法计算标记的位置，定位结果的精度在~1~米左右。\par
    为追求更高的定位精度，部分研究人员提出使用~UWB~技术进行定位。~Krishnan~等人在~2007~年为机器人室内定位导航设计了一套基于~UWB~红外的定位系统\upcite{krishnan2007a}，该系统设定~UWB~监测器的位置，将~UWB~发射器安装在机器人上，通过到达时间差（Time Difference of Arrival，TDOA）方法实现对机器人的室内定位和导航，它以~15~厘米的定位误差体现了~UWB~定位的优异性，但是其高昂的成本、额外的硬件设备要求以及不够大的定位范围限制了其被广泛使用。\par
    大部分室内定位技术为了提高定位精度而牺牲了成本，使得精度较高的定位技术使用有所局限，一些研究人员从计算机视觉的角度出发，试图寻找定位技术精度与成本的制衡点。在~2011~年，~Werner Martin~等人提出了~MoVIPS~系统\upcite{werner2011indoor}，该系统分为标定与定位两部分，标定部分通过相机拍摄的图像创建特征数据库，定位部分中相机拍摄的一张图像会传输到服务器中，服务器使用加速的具有鲁棒性的特征（Speeded Up Robust Features，SURF）\upcite{bay2006surf:}算法提取特征并与特征数据库进行匹配，这两部分结合完成了对物体的定位，定位的误差在~1.3~米左右。在~2009~年，~Mulloni Alessandro~等人提出了基于条形标记物识别的定位系统~SignPost~\upcite{mulloni2009indoor}，它能够识别相机视野中的条形标记物并使用透视形变的方法计算物体与标记的相对位置，在条形标记物的帮助下，系统的定位精度能到达厘米级。微软研究院的~EasyLiving~系统\upcite{brumitt2000easyliving:}于~2000~年被提出，这个较早提出的定位系统在平面的定位精度能够达到~10~cm，而该系统也成为了微软~Kinect~\upcite{leyvand2011kinect}生产线的先驱者。\par
    表\ref{compareInLocation}中列出了上述提到的各个热点定位技术的优缺点对比。
    \begin{table}[htb]
        \centering
        \setlength{\abovecaptionskip}{0pt}   
        \setlength{\belowcaptionskip}{10pt}
        \caption{热点定位技术的比较}
        \resizebox{\textwidth}{50mm}{
        \begin{tabular}{m{0.3\columnwidth}<{\centering}m{0.3\columnwidth}<{\centering}m{0.3\columnwidth}<{\centering}}
            \toprule[2pt]
            定位技术 & 优点 & 缺点 \\
            \midrule[2pt]
            WiFi & 使用成本较低，同时拥有较好的定位精度，覆盖面广，有很好的应用前景 & 依赖于AP，AP的变更对定位影响很大 \\
            \midrule[1pt]
            超声波 & 精度很高，技术成熟 & 需要大量额外的设备，造成应用成本较高，且对设备的摆放位置有很高的要求，容易受到干扰 \\
            \midrule[1pt]
            射频识别 & 通讯范围大，成本较低，非视距，非接触 & 定位有效范围较小，在没有辅助技术的情况下精度很低 \\
            \midrule[1pt]
            UWB & 定位精度极高，功耗低，抗干扰能力强 & 极高的应用成本，定位有效范围有限 \\
            \midrule[1pt]
            计算机视觉 & 成本低，定位精度有时能到达厘米级，充分利用了室内环境的视觉信息 & 由于定位的基础数据来源于环境，对环境光照变化比较敏感，使得定位精度的波动较大 \\
            \bottomrule[2pt]
       \end{tabular}}
       \label{compareInLocation}
    \end{table}
    在规避或减弱环境光照变化带来的负面影响后，计算机视觉定位技术脱颖而出，以低成本高精度的特点被广泛采用。当定位的对象被限定为移动机器人时，许多室内定位技术便显得不再实用，毕竟移动机器人可安装的传感器有限，成本开销也需要控制，因此计算机视觉定位成为了近几年室内定位的研究热门。\par
    计算机视觉定位技术大多以相机为传感器做定位数据的获取，根据相机安装方式的不同，计算机视觉定位技术被分为两类：（1）“被动”方式，相机被设置在移动机器人上，移动机器人在环境中移动并通过相机去感知环境，最后对比数据库中的定位信息形成定位结果；（2）“主动”方式，一个或多个相机被固定安装在环境中，监视出现在视野中的移动机器人，借助机器人或标记物的特征对机器人进行定位\upcite{brena2017evolution}。\par
    视觉里程计（Visual Odometry，VO）\upcite{nister2004visual}是典型的“被动”方式，能够根据有序的图像序列实时计算机器人的位置。~Kitt Bernd~等人基于~VO~提出使用双目相机采集图片序列并结合滤波技术的方法\upcite{kitt2010visual}，实现以更低的计算开销获得更好的定位精度。融合了~VO~，同时定位与建图（Simultaneous Location and Mapping，SLAM）技术\upcite{leonard1991mobile}获得了更好的实时性，视觉~SLAM~在机器人定位导航领域起到了巨大的作用。基于特征检测的~ORB-SLAM~\upcite{murartal2015orb-slam:,murartal2017orb-slam2:}、基于直接法的~LSD-SLAM~\upcite{engel2014lsd-slam:}以及近几年刚被提出基于前两者优秀策略的~PL-SLAM~\upcite{pumarola2017pl-slam:}在视觉定位方面都有很好的表现。微软公司的~EasyLiving~系统则是属于“主动”方式，由于这种“主动”方式依赖于机器人的特征，更多的研究工作便致力于机器人特征的提取以及机器人特征的统一。视觉标记是机器人特征统一很好的方式，标记依附在机器人表面，以特定规则呈现特征，使得定位更加简单，比如~apriltag~标记\upcite{olson2011apriltag:,wang2016apriltag}。\par
    在定位的过程中，大部分的低成本机器人本身不具有很强的计算能力，通常需要借助主机对采集的视觉信息进行处理，因此机器人与主机之间存在频繁的信息交互。为了提高交互的效率以及视觉定位技术的开发效率，机器人操作系统（Robot Operating System，ROS）\upcite{quigley2009ros:}于~2007~年被提出并在~2010~年正式开源。它不同于底层的操作系统，是一种次级操作系统，为开发者提供稳定的工具程序和库，简化开发的过程。~ROS~不仅支持点对点设计，还兼容多种编程语言并且易于模块化，以丰富的工具包、无索取开源的特点成为机器人研究领域的开发利器。\par
    相机作为计算机视觉定位技术的主要传感器，发挥着采集环境图像的巨大作用。根据相机的硬件配置类型与功能，视觉定位中的相机被分为单目相机、双目相机和深度相机，如图\ref{img1_3}所示。单目相机比较普遍，具有标定简单、成本低以及尺度不确定性的特点；双目相机如今被更多地应用到计算机视觉定位中，具有观测距离远、标定复杂的特点；深度相机相对前两者能够更加轻易地获取图像中的深度信息，但是成本高和稳定性差是它的缺陷。\par
    \begin{figure}[htb]
        \centering
        \subfigure[单目相机]{
            \begin{minipage}{0.4\textwidth}
                \centering
                \includegraphics[width=1.0\textwidth]{1-3a.jpg}
            \end{minipage}
        }
        \subfigure[双目相机]{
            \begin{minipage}{0.4\textwidth}
                \centering
                \includegraphics[width=1.0\textwidth]{1-3b.jpg}
            \end{minipage}
        }
        \subfigure[深度相机]{
            \begin{minipage}{0.4\textwidth}
                \centering
                \includegraphics[width=1.0\textwidth]{1-3c.jpg}
            \end{minipage}
        }
        \caption{视觉相机}
        \label{img1_3}
    \end{figure}
    国内对于室内机器人视觉定位技术的研究开始得比较晚，更多的是基于国外先进技术的改进与优化，缺少突出的理论成果，但仍有许多研究机构和公司已经形成了一些成果。上海交通大学自动化研究所提出一种利用天花板特征点对机器人进行视觉定位的方法\upcite{pan2006}，此后中科院自动化研究所同样利用天花板特征点提出基于直线和单特征点的视觉推算定位方法\upcite{han2008}。香港科技大学基于视觉~SLAM~，提出通过滑动窗口优化完成视觉与惯性测量单位（Inertial Measurement Unit，IMU）的有效融合，进一步提高了“被动”方式定位的精度和稳定性\upcite{qin2018vins-mono:}。\par

\section{研究内容}
    近年来，自主移动机器人更多地被应用于室内场景，在各个方面为人类提供更为全面的服务，这得益于移动机器人日渐完善的自主性。机器人实现自主性的首要任务是对周围环境的感知，从而理解自身所处的位置，为下一步自主性行为提供准确的数据支持。室内定位技术能够协助机器人识别环境，研究针对移动机器人的室内定位技术对机器人的自主性形成有极其重要的意义。\par
    本文围绕移动机器人的室内定位技术，提出如下研究内容：\par
    （1）将具有服务性质并且作为室内移动机器人典型的扫地机器人作为研究载体，依托于石头科技公司的硬件嵌入式扫地机器人，以位姿估计算法为核心，借助单目工业相机作为外部传感器，在~PC~平台上搭建一个室内移动机器人跟踪定位系统，利用标记物进行特征统一，设计跟踪器与检测器提取图像特征，实现针对扫地机器人的室内小规模定位。系统由四个模块组成，初始化模块获取系统初始数据，结构化整个定位过程的运作，同时也是其他模块的数据来源；特征检测模块对目标区域进行跟踪并提取区域中的关键角点特征，将角点特征的位置信息作为定位的基础数据提供给其他模块；机器人定位模块执行对相机与扫地机器人的位姿估计；可视化模块将连续时间的定位结果以路径的形式更加直观地进行呈现。\par
    （2）针对一台相机定位扫地机器人时存在的异物遮挡、深度信息缺失等问题，本文提出基于多台相机的定位优化方法。该方法通过多台相机布局的场景搭建，弥补对扫地机器人移动中深度变化的感知，同时借助标记物设定基准坐标系达到坐标系统一的目的。此外，为了满足多台相机同时定位的要求本文设计了多相机协同运作机制，以多线程的方式执行从采集图像到完成定位的一系列任务，考虑多台相机参与机器人定位带来的协同性，提出了用于保持跟踪器对机器人跟踪的重跟踪算法。针对多台相机采集图像存在时间差的问题，本文设计了一种时间同步算法，该算法对复杂繁多的定位结果进行时间统一，在整理融合之后给出多相机场景下优化后的定位结果。\par
    （3）以多台相机参与定位的布局场景为基础，本文提出了围绕场景中相机与待优化定位点进行图构建的图优化方法，在为图中元素赋予定义后，引入重投影误差，通过分析图中一条边的误差优化问题，形成以全图为基础的整体优化问题，最终线性求解该优化问题得到对定位点坐标的修正坐标，从而降低多相机场景中积累的噪声误差。
\section{全文结构}
    本文的结构安排如下：\par
    第一章首先介绍了机器人的发展情况，同时列举了几种具有代表性的室内移动机器人和室外移动机器人，对比其工作环境，引出研究室内定位技术的重要意义，然后对室内定位技术的发展历史以及关键节点进行梳理，围绕室内移动机器人对计算机视觉定位领域进行了着重说明，最后介绍本文的研究对象并阐述了相关研究内容。\par
    第二章首先描述了计算机视觉系统中四大坐标系之间的转换过程，引出转换过程中起关键作用的相机外参与内参，然后阐述了常用的相机内参标定方法原理，接着描述了在计算机视觉定位领域中具有重要作用的目标跟踪与检测技术，对它们的作用原理和技术分类进行了简单的说明。最后围绕计算机视觉定位领域中的关键方法――位姿估计方法，阐述了~2D-2D~、~3D-3D~、~2D-3D~三种情况下的位姿估计方法原理。\par
    第三章描述了室内移动机器人跟踪定位系统的模块化设计，分别对初始化模块、特征检测模块、机器人定位模块和可视化模块这四个模块展开详细说明。初始化模块加载相机内参等本地数据并为其他模块提供计算数据，特征检测模块使用跟踪器与检测器对相机采集的图像中的关键特征角点进行提取，机器人定位模块结合角点特征的位置信息与相机内参数据对相机与机器人的位姿进行估计，可视化模块直观呈现连续时间内的定位结果。\par
    第四章首先分析了单相机场景下进行室内定位移动机器人的局限性，然后围绕这些局限性，描述了基于多相机的定位优化方法，其中突出了多台相机的布局方案、坐标系统一的策略、多相机协同运作的机制以及以时间同步为目的的定位结果融合方法这四个方面，其中在多相机协同运作机制的设计中考虑各台相机之间的信息交互，阐述了增加系统稳定性的重跟踪算法。最后详细说明了以多相机场景为基础构建图的过程以及围绕已构建的图对~3D~定位点进行优化的方法。\par
    第五章首先介绍实验平台的构建，简要说明评价指标和软硬件实验平台，然后设计三个实验进行结果对比，分别是采用一个相机的定位实验、多相机参与的定位实验和融合图优化的定位实验。最后将三组结果数据与~ground truth~进行对比分析，得出结论。\par
    第六章对全文进行概括性的总结，根据室内定位技术的发展前景以及当前的科学发展趋势提出未来的研究计划。